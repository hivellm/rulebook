# Tasks: Ralph Human-in-the-Loop Planning Checkpoint

- [ ] Add `PlanCheckpointConfig` type to `src/types.ts`
- [ ] Add `ralph.planCheckpoint` to config-manager.ts schema
- [ ] Implement `generateIterationPlan(story, tool)` in ralph-manager.ts
  - [ ] Runs AI tool with plan-only prompt
  - [ ] Captures plan output without executing implementation
- [ ] Implement `requestPlanApproval(plan)` interactive prompt
  - [ ] Display plan to terminal in formatted box
  - [ ] Wait for: `approve` | `reject <reason>` | `edit <feedback>`
  - [ ] Auto-approve after N seconds if autoApproveAfterSeconds > 0
- [ ] Wire planning phase into story iteration loop (before implementation)
- [ ] Add rejection reason to story context for next iteration attempt
- [ ] Add `--plan-first` flag to `ralph run` CLI command
- [ ] Add `rulebook ralph config set planCheckpoint.enabled true` support
- [ ] Skip checkpoint if `--yes` / non-interactive mode
- [ ] Write test: plan generated before implementation
- [ ] Write test: rejection adds reason to next iteration context
- [ ] Write test: auto-approve after timeout
- [ ] Write test: --yes flag skips checkpoint
- [ ] Run full test suite
